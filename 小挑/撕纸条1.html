<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>情绪释放 - 撕纸条</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Microsoft YaHei', sans-serif;
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
      color: #333;
    }

    .container {
      max-width: 800px;
      width: 100%;
      background: white;
      border-radius: 20px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      overflow: hidden;
      margin-bottom: 20px;
    }

    .header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 30px;
      text-align: center;
    }

    .header h1 {
      font-size: 2.2em;
      margin-bottom: 10px;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
    }

    .header p {
      font-size: 1.1em;
      opacity: 0.9;
    }

    .input-section {
      padding: 30px;
      border-bottom: 1px solid #eee;
    }

    .input-group {
      margin-bottom: 20px;
    }

    label {
      display: block;
      margin-bottom: 10px;
      font-weight: bold;
      color: #555;
    }

    textarea {
      width: 100%;
      height: 120px;
      padding: 15px;
      border: 2px solid #e1e5e9;
      border-radius: 10px;
      font-size: 16px;
      resize: vertical;
      transition: border-color 0.3s;
    }

    textarea:focus {
      outline: none;
      border-color: #667eea;
    }

    .btn {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 12px 25px;
      border-radius: 25px;
      font-size: 16px;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
    }

    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
    }

    .btn:active {
      transform: translateY(0);
    }

    .paper-section {
      padding: 20px;
      text-align: center;
    }

    .paper-container {
      position: relative;
      margin: 0 auto;
      background: #fff9e6;
      border: 1px solid #e6d8ad;
      border-radius: 5px;
      box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
      padding: 25px;
      margin-bottom: 20px;
      min-height: 150px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .anxiety-text {
      font-size: 18px;
      line-height: 1.6;
      color: #5d4037;
      text-align: center;
      max-width: 90%;
      word-break: break-word;
    }

    .canvas-container {
      position: relative;
      margin: 0 auto;
      border: 2px dashed #ccc;
      border-radius: 10px;
      overflow: hidden;
      background: #fff9e6;
    }

    #tearing-canvas {
      display: block;
      background: transparent;
      cursor: crosshair;
    }

    .instructions {
      margin-top: 15px;
      color: #666;
      font-size: 14px;
      text-align: center;
    }

    .hidden {
      display: none;
    }

    .anxiety-list {
      margin-top: 20px;
      max-height: 200px;
      overflow-y: auto;
      border: 1px solid #e1e5e9;
      border-radius: 10px;
      padding: 10px;
    }

    .anxiety-item {
      padding: 10px;
      margin-bottom: 8px;
      background: #f8f9fa;
      border-radius: 8px;
      border-left: 4px solid #667eea;
      cursor: pointer;
      transition: background 0.2s;
    }

    .anxiety-item:hover {
      background: #e9ecef;
    }

    .controls {
      display: flex;
      gap: 10px;
      justify-content: center;
      margin-top: 20px;
    }

    .btn-secondary {
      background: #6c757d;
      box-shadow: 0 4px 15px rgba(108, 117, 125, 0.4);
    }

    .btn-secondary:hover {
      box-shadow: 0 6px 20px rgba(108, 117, 125, 0.6);
    }

    .particle {
      position: absolute;
      background: #ff6b6b;
      border-radius: 50%;
      pointer-events: none;
    }

    @media (max-width: 600px) {
      .container {
        border-radius: 10px;
      }

      .header {
        padding: 20px;
      }

      .header {
        padding: 20px;
      }

      .header h1 {
        font-size: 1.8em;
      }

      .input-section,
      .paper-section {
        padding: 20px;
      }

      .controls {
        flex-direction: column;
      }
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="header">
      <h1>情绪释放空间</h1>
      <p>写下你的焦虑，然后把它撕成碎片</p>
    </div>

    <div class="input-section">
      <div class="input-group">
        <label for="anxiety-input">写下让你感到焦虑或厌烦的事情：</label>
        <textarea id="anxiety-input" placeholder="例如：工作压力太大、人际关系紧张、对未来感到迷茫..."></textarea>
      </div>
      <button id="add-btn" class="btn">添加到焦虑清单</button>

      <div id="anxiety-list" class="anxiety-list hidden">
        <!-- 焦虑事项将在这里显示 -->
      </div>
    </div>

    <div class="paper-section">
      <div id="paper-container" class="paper-container hidden">
        <div id="anxiety-text" class="anxiety-text">
          <!-- 选中的焦虑事项将在这里显示 -->
        </div>
      </div>

      <div id="canvas-container" class="canvas-container hidden">
        <canvas id="tearing-canvas"></canvas>
      </div>

      <div id="instructions" class="instructions hidden">
        用鼠标在纸条上拖动，把它撕成碎片吧！
      </div>

      <div class="controls">
        <button id="start-tearing" class="btn hidden">开始撕碎</button>
        <button id="reset-btn" class="btn btn-secondary hidden">重新开始</button>
      </div>
    </div>
  </div>
  <script>
    // 获取DOM元素
    const anxietyInput = document.getElementById('anxiety-input');
    const addBtn = document.getElementById('add-btn');
    const anxietyList = document.getElementById('anxiety-list');
    const paperContainer = document.getElementById('paper-container');
    const anxietyText = document.getElementById('anxiety-text');
    const canvasContainer = document.getElementById('canvas-container');
    const tearingCanvas = document.getElementById('tearing-canvas');
    const instructions = document.getElementById('instructions');
    const startTearingBtn = document.getElementById('start-tearing');
    const resetBtn = document.getElementById('reset-btn');

    // 焦虑事项数组
    let anxieties = [];
    // 当前选中的焦虑事项
    let currentAnxiety = null;

    // Canvas上下文和状态
    const ctx = tearingCanvas.getContext('2d');
    let isTearing = false;
    let lastX, lastY;
    let tearPoints = [];
    let paperParticles = [];

    // 调整Canvas大小
    function resizeCanvas() {
      const containerWidth = canvasContainer.clientWidth;
      const containerHeight = Math.min(400, window.innerHeight * 0.5);

      tearingCanvas.width = containerWidth;
      tearingCanvas.height = containerHeight;

      // 重置Canvas内容
      redrawPaper();
    }

    // 重绘纸张
    function redrawPaper() {
      ctx.clearRect(0, 0, tearingCanvas.width, tearingCanvas.height);

      // 绘制纸张背景
      ctx.fillStyle = '#fff9e6';
      ctx.fillRect(0, 0, tearingCanvas.width, tearingCanvas.height);

      // 绘制纸张纹理
      ctx.fillStyle = 'rgba(230, 216, 173, 0.1)';
      for (let i = 0; i < tearingCanvas.width; i += 10) {
        for (let j = 0; j < tearingCanvas.height; j += 10) {
          if ((i + j) % 20 === 0) {
            ctx.fillRect(i, j, 2, 2);
          }
        }
      }

      // 绘制焦虑文字
      if (currentAnxiety) {
        ctx.fillStyle = '#5d4037';
        ctx.font = '16px Microsoft YaHei';
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';

        // 文字换行处理
        const maxWidth = tearingCanvas.width - 40;
        const words = currentAnxiety.split(' ');
        let line = '';
        let lines = [];
        let y = tearingCanvas.height / 2 - (words.length * 10);

        for (let i = 0; i < words.length; i++) {
          const testLine = line + words[i] + ' ';
          const metrics = ctx.measureText(testLine);
          const testWidth = metrics.width;

          if (testWidth > maxWidth && i > 0) {
            lines.push(line);
            line = words[i] + ' ';
          } else {
            line = testLine;
          }
        }
        lines.push(line);

        // 绘制多行文字
        for (let i = 0; i < lines.length; i++) {
          ctx.fillText(lines[i], tearingCanvas.width / 2, y + (i * 24));
        }
      }

      // 绘制撕裂路径
      if (tearPoints.length > 0) {
        ctx.strokeStyle = '#ff6b6b';
        ctx.lineWidth = 3;
        ctx.lineCap = 'round';
        ctx.lineJoin = 'round';

        ctx.beginPath();
        ctx.moveTo(tearPoints[0].x, tearPoints[0].y);

        for (let i = 1; i < tearPoints.length; i++) {
          ctx.lineTo(tearPoints[i].x, tearPoints[i].y);
        }

        ctx.stroke();
      }
    }
    // 创建纸张粒子效果
    function createParticles(x, y) {
      const particleCount = 5;

      for (let i = 0; i < particleCount; i++) {
        const particle = document.createElement('div');
        particle.className = 'particle';

        const size = Math.random() * 5 + 2;
        particle.style.width = `${size}px`;
        particle.style.height = `${size}px`;
        particle.style.left = `${x}px`;
        particle.style.top = `${y}px`;
        particle.style.backgroundColor = `hsl(${Math.random() * 30 + 10}, 70%, 60%)`;

        document.body.appendChild(particle);
        paperParticles.push(particle);

        // 粒子动画
        const angle = Math.random() * Math.PI * 2;
        const speed = Math.random() * 3 + 1;
        const vx = Math.cos(angle) * speed;
        const vy = Math.sin(angle) * speed;

        let opacity = 1;
        const fadeInterval = setInterval(() => {
          opacity -= 0.05;
          particle.style.opacity = opacity;
          particle.style.transform = `translate(${vx * (1 - opacity) * 20}px, ${vy * (1 - opacity) * 20}px)`;

          if (opacity <= 0) {
            clearInterval(fadeInterval);
            if (particle.parentNode) {
              particle.parentNode.removeChild(particle);
            }
            paperParticles = paperParticles.filter(p => p !== particle);
          }
        }, 50);
      }
    }

    // 添加焦虑事项
    function addAnxiety() {
      const text = anxietyInput.value.trim();
      if (text === '') {
        alert('请输入一些内容');
        return;
      }

      anxieties.push(text);
      anxietyInput.value = '';

      // 更新焦虑清单显示
      updateAnxietyList();

      // 显示焦虑清单
      anxietyList.classList.remove('hidden');
    }

    // 更新焦虑清单
    function updateAnxietyList() {
      anxietyList.innerHTML = '';

      anxieties.forEach((anxiety, index) => {
        const item = document.createElement('div');
        item.className = 'anxiety-item';
        item.textContent = anxiety;
        item.addEventListener('click', () => selectAnxiety(index));
        anxietyList.appendChild(item);
      });
    }

    // 选择焦虑事项
    function selectAnxiety(index) {
      currentAnxiety = anxieties[index];
      anxietyText.textContent = currentAnxiety;
      paperContainer.classList.remove('hidden');
      startTearingBtn.classList.remove('hidden');
    }

    // 开始撕纸条
    function startTearing() {
      paperContainer.classList.add('hidden');
      canvasContainer.classList.remove('hidden');
      instructions.classList.remove('hidden');
      startTearingBtn.classList.add('hidden');
      resetBtn.classList.remove('hidden');

      // 重置Canvas状态
      tearPoints = [];
      resizeCanvas();
    }

    // 重置
    function reset() {
      paperContainer.classList.add('hidden');
      canvasContainer.classList.add('hidden');
      instructions.classList.add('hidden');
      startTearingBtn.classList.add('hidden');
      resetBtn.classList.add('hidden');

      // 清除所有粒子
      paperParticles.forEach(particle => {
        if (particle.parentNode) {
          particle.parentNode.removeChild(particle);
        }
      });
      paperParticles = [];

      currentAnxiety = null;
      anxietyText.textContent = '';
    }
    // Canvas事件处理
    tearingCanvas.addEventListener('mousedown', startTear);
    tearingCanvas.addEventListener('mousemove', tear);
    tearingCanvas.addEventListener('mouseup', stopTear);
    tearingCanvas.addEventListener('mouseleave', stopTear);

    // 触摸事件支持
    tearingCanvas.addEventListener('touchstart', (e) => {
      e.preventDefault();
      const touch = e.touches[0];
      const mouseEvent = new MouseEvent('mousedown', {
        clientX: touch.clientX,
        clientY: touch.clientY
      });
      tearingCanvas.dispatchEvent(mouseEvent);
    });

    tearingCanvas.addEventListener('touchmove', (e) => {
      e.preventDefault();
      const touch = e.touches[0];
      const mouseEvent = new MouseEvent('mousemove', {
        clientX: touch.clientX,
        clientY: touch.clientY
      });
      tearingCanvas.dispatchEvent(mouseEvent);
    });

    tearingCanvas.addEventListener('touchend', (e) => {
      e.preventDefault();
      const mouseEvent = new MouseEvent('mouseup');
      tearingCanvas.dispatchEvent(mouseEvent);
    });

    function startTear(e) {
      isTearing = true;
      const rect = tearingCanvas.getBoundingClientRect();
      lastX = e.clientX - rect.left;
      lastY = e.clientY - rect.top;

      tearPoints.push({ x: lastX, y: lastY });
      createParticles(e.clientX, e.clientY);
    }

    function tear(e) {
      if (!isTearing) return;

      const rect = tearingCanvas.getBoundingClientRect();
      const currentX = e.clientX - rect.left;
      const currentY = e.clientY - rect.top;

      tearPoints.push({ x: currentX, y: currentY });

      // 重绘Canvas
      redrawPaper();

      // 创建粒子效果
      createParticles(e.clientX, e.clientY);

      lastX = currentX;
      lastY = currentY;
    }

    function stopTear() {
      isTearing = false;
    }

    // 事件监听
    addBtn.addEventListener('click', addAnxiety);
    startTearingBtn.addEventListener('click', startTearing);
    resetBtn.addEventListener('click', reset);

    // 窗口大小改变时调整Canvas
    window.addEventListener('resize', resizeCanvas);

    // 初始化
    anxietyInput.focus();
  </script>
</body>

</html>